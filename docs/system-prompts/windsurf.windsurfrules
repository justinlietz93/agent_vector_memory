# Coding Guidelines
- Modular monolith; strict layering; no provider bleed; no shims; â‰¤ 500 LOC/file.
- Public APIs: full docstrings (purpose, params, returns, exceptions, side effects, timeout/retry).
- Add/adjust unit tests for each change; keep fast and isolated.
- Never commit or print secrets/tokens; use environment variables only.
- Prefer surgical edits over rewrites; keep diffs minimal and reversible.
- Timeouts: use provided helpers where available; log provider + operation context on exceptions.
- Subprocess: absolute binaries, fixed arg lists, shell=False; never interpolate user input.
- Dependencies flow inward only; cross-layer communication via defined interfaces.

# Vector Memory (Ollama + Qdrant)
- Env:
  - QDRANT_URL=http://localhost:6333
  - OLLAMA_URL=http://localhost:11434
  - EMBED_MODEL=mxbai-embed-large
  - MEMORY_COLLECTION_NAME=<primary> (required); MEMORY_COLLECTION_NAME_2..N=<optional additional>
- Ensure collection:
  - python -m vector_memory.cli.main ensure-collection --name "$MEMORY_COLLECTION_NAME"
- Index memory-bank:
  - python -m vector_memory.cli.main index-memory-bank --name "$MEMORY_COLLECTION_NAME" --dir memory-bank --idns "mem"
- Query before coding:
  - python -m vector_memory.cli.main query --name "$MEMORY_COLLECTION_NAME" --q "What prior decisions affect <TASK>?" --k 8 --with-payload
- Store concise, reusable facts only (no secrets/PII/chat logs) in memory-bank/*.md, then re-index.

# Workflow (Strict)
1) Recall constraints:
   - python -m vector_memory.cli.main query --name "$MEMORY_COLLECTION_NAME" --q "Summarize constraints for <TOPIC>" --k 8 --with-payload
2) Plan minimal layered changes honoring ARCHITECTURE_RULES.md and retrieved memory.
3) Implement minimal edits; update/add unit tests.
4) Append stable decisions as bullets to memory-bank/activeContext.md or memory-bank/decisionLog.md; re-index.

# Guardrails
- Validate env/config and collection; re-run ensure-collection on contract errors.
- No transitional shims; perform full replacements for deprecations.
- Keep secrets and large diffs out of memory; do not store logs or chat transcripts.
